<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{url_for('static', filename='css/index.css') }}" rel="stylesheet" type="text/css"/>
    <title>ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì‚´</title>
</head>
<body>
    <div class="container">
        <div class="chat-container">
            <div class="chat-header"><img src="{{ url_for('static', filename='images/inha_emb.png') }}" height="45" width="45">INHA UNIVERSITY</div>
            <div class="messages">
                <div class="bot_prof"><img class="inha" src="{{ url_for('static', filename='images/induk.jpg') }}" height="45" width="45" style="cursor: pointer;"
                        onclick="refreshPage()"></div>
                <div class="message_bot_name bot-message_name">
                    <div class="message-author inbot">ê¸°ê³„ì¸ë• ğŸ¦†</div>
                </div>
                <div class="message bot-message">
                    <div>ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ” ì¸í•˜ëŒ€í•™êµ ì±—ë´‡ ê¸°ê³„ì¸ë•ì´ì—ìš”ğŸ¦†</div>
                    <div>âœ”í™ˆí˜ì´ì§€ ê³µì§€ì‚¬í•­ âœ”ì—ë¸Œë¦¬íƒ€ì„ ë“± ì—´ì‹¬íˆ ê³µë¶€í–ˆë‹µë‹ˆë‹¤ğŸ˜Š</div>
                    <div>ì–¸ì œë‚˜ ì—¬ëŸ¬ë¶„ì˜ ê¶ê¸ˆì¦ì„ í•´ê²°í•´ì£¼ëŠ” ê¸°ê³„ì¸ë•ì´ ë°”ë¡œ ë‹µë³€í•´ë“œë ¤ìš”!</div>
                    <div>ì°½ì„ ì •ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´ ì œ ì–¼êµ´ì„ ëˆŒëŸ¬ì£¼ì„¸ìš” @.@ </div>
                    <div class="message bot-message1 button-grid">
                        <div class="button"> <button onclick="handleButtonClick('A1')">í•™ì‚¬ì¼ì •</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A2')">ìº í¼ìŠ¤ë§µ</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A3')">ìˆ˜ê°•ì‹ ì²­</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A4')">êµë‚´ì—°ë½ì²˜</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A5')">I-Class</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A6')">í•™ê³¼ë³„ ì‚¬ì´íŠ¸ ì¡°íšŒ</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A7')">í¸ì˜ ì‹œì„¤</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A8')">ì •ì„í•™ìˆ ì •ë³´ê´€</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A9')">ì¦ëª…ì„œ ë°œê¸‰ ì‹œìŠ¤í…œ</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A10')">ì¸í•˜ëŒ€í•™êµ ì˜¤ì‹œëŠ” ê¸¸</button> </div>
                    </div>
                </div>
            </div>
            <div class="message-input">
                <input type="text" id="user-input" placeholder="ê¶ê¸ˆí•˜ì‹  ì ì„ ì§ˆë¬¸í•´ì£¼ì„¸ìš” !" autofocus>
                <button_send id="sendButton" onclick="chatbotAnswer()">ì „ì†¡</button_send>
            </div>
        </div>
    </div>
    <script>
        function refreshPage() {
            window.location.reload();
        }

        // ì‚¬ìš©ìê°€ ì„ íƒí•œ ë²„íŠ¼ì— ë”°ë¼ ë‹¤ë¥¸ ë‹µë³€ì„ ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜
        function handleButtonClick(buttonName) {
            if (buttonName === "A1") {
                var answer = "ì¸í•˜ëŒ€í•™êµ 2024í•™ë…„ë„ 1í•™ê¸° 5~6ì›” í•™ì‚¬ì¼ì •ì— ëŒ€í•´ ì•Œë ¤ë“œë¦´ê²Œìš” ğŸ¦† \n\n"+
                "05.24(ê¸ˆ) (ìˆ˜ì—…ì¼ìˆ˜ 3/4ì„ )\n"+
                "05.27(ì›”) ~ 05.28(í™”) 2024í•™ë…„ë„ í•˜ê³„ ê³„ì ˆí•™ê¸° ìˆ˜ê°•ì‹ ì²­\n"+
                "05.27(ì›”) ~ 05.28(í™”) 2024-1í•™ê¸° ìš°ìˆ˜ì¸ì¬ì¸ì¦ ì‹ ì²­\n\n"+
                "06.10(ì›”) ~ 06.14(ê¸ˆ) 2024-1í•™ê¸° ê¸°ë§ê³ ì‚¬\n"+
                "06.17(ì›”) ~ 06.21.(ê¸ˆ) 2024-1í•™ê¸° ë³´ê°•ì£¼ê°„\n"+
                "06.24(ì›”) ~ 07.17(ìˆ˜) 2024í•™ë…„ë„ í•˜ê³„ ê³„ì ˆí•™ê¸° ìˆ˜ì—…\n";
                displayAnswer(answer);
            } else if (buttonName === "A2") {
                var answer = "ì§ˆë¬¸ 2ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } else if (buttonName === "A3") {
                var answer = "ì§ˆë¬¸ 3ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } else if (buttonName === "A4") {
                var answer = "ì§ˆë¬¸ 4ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } else if (buttonName === "A5") {
                var answer = "ì§ˆë¬¸ 5ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } else if (buttonName === "A6") {
                var answer = "ì§ˆë¬¸ 6ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } else if (buttonName === "A7") {
                var answer = "ì§ˆë¬¸ 7ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } else if (buttonName === "A8") {
                var answer = "ì§ˆë¬¸ 8ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);    
            } else if (buttonName === "A9") {
                var answer = "ì§ˆë¬¸ 9ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } else if (buttonName === "A10") {
                var answer = "ì§ˆë¬¸ 10ë²ˆì— ëŒ€í•œ ë‹µë³€ ì¤€ë¹„ì¤‘(ê¸€ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”)";
                displayAnswer(answer);
            } 
        }

        // ë‹µë³€ì„ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function displayAnswer(answer) {
            // ì‚¬ìš©ì ì±„íŒ…ì°½ ìƒì„±
            var chatContainer = document.querySelector(".messages");
    
            // ì±—ë´‡ í”„ë¡œí•„ ì´ë¯¸ì§€ ìƒì„±
            var botProfile = document.createElement("div");
            botProfile.classList.add("bot_prof");
            botProfile.innerHTML = '<img class="inha" src="induk.jpg" height="45" width="45" style="cursor: pointer;" onclick="refreshPage()">';
            chatContainer.appendChild(botProfile); // ì±—ë´‡ í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
    
            var botMessageContainer = document.createElement("div"); // ì±—ë´‡ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ ìƒì„±
            botMessageContainer.classList.add("message", "bot-message"); // ì±—ë´‡ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ í´ë˜ìŠ¤ ì¶”ê°€
    
            var botName = document.createElement("div"); // ì±—ë´‡ ì´ë¦„ ìš”ì†Œ ìƒì„±
            botName.classList.add("message-author", "bot"); // ì±—ë´‡ ì´ë¦„ í´ë˜ìŠ¤ ì¶”ê°€
            botName.innerText = "ê¸°ê³„ì¸ë•"; // ì±—ë´‡ ì´ë¦„ ì„¤ì •
            chatContainer.appendChild(botName); // ì±—ë´‡ ì´ë¦„ ìš”ì†Œë¥¼ ì±—ë´‡ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
    
            var botMessage = document.createElement("div"); // ì±—ë´‡ ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
            botMessage.innerText = answer; // ì±—ë´‡ ë©”ì‹œì§€ ì„¤ì •
            botMessageContainer.appendChild(botMessage); // ì±—ë´‡ ë©”ì‹œì§€ ìš”ì†Œë¥¼ ì±—ë´‡ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
    
            chatContainer.appendChild(botMessageContainer); // ì±—ë´‡ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆë¥¼ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        function chatbotAnswer() {
            var userInput = document.getElementById("user-input").value;
            if (userInput.trim() === "") return;

            // ì‚¬ìš©ì ì±„íŒ…ì°½ ìƒì„±
            var chatContainer = document.querySelector(".messages");
            var userMessage = document.createElement("div");
            userMessage.classList.add("message", "user-message");
            userMessage.innerHTML = `<div class="message-author user">ì‚¬ìš©ì</div>${userInput}`;
            chatContainer.appendChild(userMessage);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // ì…ë ¥ì°½ ë¹„í™œì„±í™”
            document.getElementById("user-input").disabled = true;

            // ì±—ë´‡ í”„ë¡œí•„ ì´ë¯¸ì§€ ìƒì„±
            var botProfile = document.createElement("div");
            botProfile.classList.add("bot_prof");
            botProfile.innerHTML = '<img class="inha" src="induk.jpg" height="45" width="45" style="cursor: pointer;" onclick="refreshPage()">';
            chatContainer.appendChild(botProfile); // ì±—ë´‡ í”„ë¡œí•„ ì´ë¯¸ì§€ë¥¼ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ì¶”ê°€

            // "ë‹µë³€ ìƒì„± ì¤‘" ë©”ì‹œì§€ ì¶”ê°€
            var loadingMessage = document.createElement("div");
            loadingMessage.classList.add("message", "bot-message");
            loadingMessage.innerHTML = `<div class="message-author bot">ì±—ë´‡</div>ë‹µë³€ ìƒì„± ì¤‘<span id="loading-dots">.</span>`;
            chatContainer.appendChild(loadingMessage);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // ì  ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            var dots = 1;
            var loadingDots = document.getElementById("loading-dots");
            var interval = setInterval(() => {
                dots = (dots % 3) + 1;
                loadingDots.textContent = '.'.repeat(dots);
            }, 500);

            // ì§ˆë¬¸ì„ ì„œë²„ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
            fetch('/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ question: userInput })
            })
            .then(response => response.json())
            .then(data => {
                text = data.answer;

                // "ë‹µë³€ ìƒì„± ì¤‘" ë©”ì‹œì§€ ì œê±°
                clearInterval(interval);
                chatContainer.removeChild(loadingMessage);
                
                // ì±—ë´‡ ì±„íŒ…ì°½ ìƒì„±
                var botMessage = document.createElement("div");
                botMessage.classList.add("message", "bot-message");
                botMessage.innerHTML = `<div class="message-author bot">ì±—ë´‡</div>${text}`;
                chatContainer.appendChild(botMessage);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // ì…ë ¥ì°½ í™œì„±í™”
                document.getElementById("user-input").disabled = false;
                // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤ ì„¤ì •
                document.getElementById("user-input").focus();
            });
                
            document.getElementById("user-input").value = "";
        }

        // ì—”í„° í‚¤ ëˆ„ë¥¼ ë•Œ ì „ì†¡ë˜ë„ë¡ ì„¤ì •
        document.getElementById("user-input").addEventListener("keypress", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                chatbotAnswer();
            }
        });
    </script>
</body>
</html>