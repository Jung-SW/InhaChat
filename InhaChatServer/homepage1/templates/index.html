<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{url_for('static', filename='css/index.css') }}" rel="stylesheet" type="text/css"/>
    <title>무엇이든 물어보살</title>
</head>
<body>
    <div class="container">
        <div class="chat-container">
            <div class="chat-header"><img src="{{ url_for('static', filename='images/inha_emb.png') }}" height="45" width="45">INHA UNIVERSITY</div>
            <div class="messages">
                <div class="bot_prof"><img class="inha" src="{{ url_for('static', filename='images/induk.jpg') }}" height="45" width="45" style="cursor: pointer;"
                        onclick="refreshPage()"></div>
                <div class="message_bot_name bot-message_name">
                    <div class="message-author inbot">기계인덕 🦆</div>
                </div>
                <div class="message bot-message">
                    <div>안녕하세요, 저는 인하대학교 챗봇 기계인덕이에요🦆</div>
                    <div>✔홈페이지 공지사항 ✔에브리타임 등 열심히 공부했답니다😊</div>
                    <div>언제나 여러분의 궁금증을 해결해주는 기계인덕이 바로 답변해드려요!</div>
                    <div>창을 정리하고 싶다면 제 얼굴을 눌러주세요 @.@ </div>
                    <div class="message bot-message1 button-grid">
                        <div class="button"> <button onclick="handleButtonClick('A1')">학사일정</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A2')">캠퍼스맵</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A3')">수강신청</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A4')">교내연락처</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A5')">I-Class</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A6')">학과별 사이트 조회</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A7')">편의 시설</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A8')">정석학술정보관</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A9')">증명서 발급 시스템</button> </div>
                        <div class="button"> <button onclick="handleButtonClick('A10')">인하대학교 오시는 길</button> </div>
                    </div>
                </div>
            </div>
            <div class="message-input">
                <input type="text" id="user-input" placeholder="궁금하신 점을 질문해주세요 !" autofocus>
                <button_send id="sendButton" onclick="chatbotAnswer()">전송</button_send>
            </div>
        </div>
    </div>
    <script>
        function refreshPage() {
            window.location.reload();
        }

        // 사용자가 선택한 버튼에 따라 다른 답변을 출력하는 함수
        function handleButtonClick(buttonName) {
            if (buttonName === "A1") {
                var answer = "인하대학교 2024학년도 1학기 5~6월 학사일정에 대해 알려드릴게요 🦆 \n\n"+
                "05.24(금) (수업일수 3/4선)\n"+
                "05.27(월) ~ 05.28(화) 2024학년도 하계 계절학기 수강신청\n"+
                "05.27(월) ~ 05.28(화) 2024-1학기 우수인재인증 신청\n\n"+
                "06.10(월) ~ 06.14(금) 2024-1학기 기말고사\n"+
                "06.17(월) ~ 06.21.(금) 2024-1학기 보강주간\n"+
                "06.24(월) ~ 07.17(수) 2024학년도 하계 계절학기 수업\n";
                displayAnswer(answer);
            } else if (buttonName === "A2") {
                var answer = "질문 2번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } else if (buttonName === "A3") {
                var answer = "질문 3번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } else if (buttonName === "A4") {
                var answer = "질문 4번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } else if (buttonName === "A5") {
                var answer = "질문 5번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } else if (buttonName === "A6") {
                var answer = "질문 6번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } else if (buttonName === "A7") {
                var answer = "질문 7번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } else if (buttonName === "A8") {
                var answer = "질문 8번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);    
            } else if (buttonName === "A9") {
                var answer = "질문 9번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } else if (buttonName === "A10") {
                var answer = "질문 10번에 대한 답변 준비중(글만 수정해주세요)";
                displayAnswer(answer);
            } 
        }

        // 답변을 화면에 표시하는 함수
        function displayAnswer(answer) {
            // 사용자 채팅창 생성
            var chatContainer = document.querySelector(".messages");
    
            // 챗봇 프로필 이미지 생성
            var botProfile = document.createElement("div");
            botProfile.classList.add("bot_prof");
            botProfile.innerHTML = '<img class="inha" src="induk.jpg" height="45" width="45" style="cursor: pointer;" onclick="refreshPage()">';
            chatContainer.appendChild(botProfile); // 챗봇 프로필 이미지를 메시지 컨테이너에 추가
    
            var botMessageContainer = document.createElement("div"); // 챗봇 메시지 컨테이너 생성
            botMessageContainer.classList.add("message", "bot-message"); // 챗봇 메시지 컨테이너 클래스 추가
    
            var botName = document.createElement("div"); // 챗봇 이름 요소 생성
            botName.classList.add("message-author", "bot"); // 챗봇 이름 클래스 추가
            botName.innerText = "기계인덕"; // 챗봇 이름 설정
            chatContainer.appendChild(botName); // 챗봇 이름 요소를 챗봇 메시지 컨테이너에 추가
    
            var botMessage = document.createElement("div"); // 챗봇 메시지 요소 생성
            botMessage.innerText = answer; // 챗봇 메시지 설정
            botMessageContainer.appendChild(botMessage); // 챗봇 메시지 요소를 챗봇 메시지 컨테이너에 추가
    
            chatContainer.appendChild(botMessageContainer); // 챗봇 메시지 컨테이너를 메시지 컨테이너에 추가
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        function chatbotAnswer() {
            var userInput = document.getElementById("user-input").value;
            if (userInput.trim() === "") return;

            // 사용자 채팅창 생성
            var chatContainer = document.querySelector(".messages");
            var userMessage = document.createElement("div");
            userMessage.classList.add("message", "user-message");
            userMessage.innerHTML = `<div class="message-author user">사용자</div>${userInput}`;
            chatContainer.appendChild(userMessage);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // 입력창 비활성화
            document.getElementById("user-input").disabled = true;

            // 챗봇 프로필 이미지 생성
            var botProfile = document.createElement("div");
            botProfile.classList.add("bot_prof");
            botProfile.innerHTML = '<img class="inha" src="induk.jpg" height="45" width="45" style="cursor: pointer;" onclick="refreshPage()">';
            chatContainer.appendChild(botProfile); // 챗봇 프로필 이미지를 메시지 컨테이너에 추가

            // "답변 생성 중" 메시지 추가
            var loadingMessage = document.createElement("div");
            loadingMessage.classList.add("message", "bot-message");
            loadingMessage.innerHTML = `<div class="message-author bot">챗봇</div>답변 생성 중<span id="loading-dots">.</span>`;
            chatContainer.appendChild(loadingMessage);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // 점 애니메이션 시작
            var dots = 1;
            var loadingDots = document.getElementById("loading-dots");
            var interval = setInterval(() => {
                dots = (dots % 3) + 1;
                loadingDots.textContent = '.'.repeat(dots);
            }, 500);

            // 질문을 서버로 보냅니다.
            fetch('/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ question: userInput })
            })
            .then(response => response.json())
            .then(data => {
                text = data.answer;

                // "답변 생성 중" 메시지 제거
                clearInterval(interval);
                chatContainer.removeChild(loadingMessage);
                
                // 챗봇 채팅창 생성
                var botMessage = document.createElement("div");
                botMessage.classList.add("message", "bot-message");
                botMessage.innerHTML = `<div class="message-author bot">챗봇</div>${text}`;
                chatContainer.appendChild(botMessage);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                // 입력창 활성화
                document.getElementById("user-input").disabled = false;
                // 입력창에 포커스 설정
                document.getElementById("user-input").focus();
            });
                
            document.getElementById("user-input").value = "";
        }

        // 엔터 키 누를 때 전송되도록 설정
        document.getElementById("user-input").addEventListener("keypress", function(event) {
            if (event.keyCode === 13) {
                event.preventDefault();
                chatbotAnswer();
            }
        });
    </script>
</body>
</html>